---
- name: Check and Restart Windows Services
  hosts: all
  gather_facts: false
  #vars:
    #services_to_check:
    #- W3SVC # IIS service name

  tasks:
  - name: Check Services
    ansible.windows.win_service_info:
      name: "{{ item }}"
     # state: started  # Can change to 'stopped' if needed
    register: service_results
    loop: "{{ services_to_check }}"

  - name: Set variable
    set_fact:
      output: "{{ service_results.results[0].services[0] }}"

  - name: Report Service Status
    debug:
      msg: "{{ output.name }} , {{ output.display_name}} is {{ output.state }}"

